#!/bin/bash
####################################################################
##
## Script to update the local RHEL7 repo
## which is used by all the other RHEL7 servers in PreProd
##
####################################################################

# Update the repo with the packages from RedHat
reposync --gpgcheck -l --repoid=rhel-7-server-rpms --download_path=/var/repo
createrepo /var/repo/rhel-7-server-rpms

# Get the repo ready for use by the other servers
yum clean all
yum list-sec
# find /var/cache/yum/ -name updateinfo.xml
/bin/cp --force /var/cache/yum/x86_64/7Server/rhel-7-server-rpms/gen/updateinfo.xml /var/repo/rhel-7-server-rpms/repodata/updateinfo.xml
modifyrepo /var/repo/rhel-7-server-rpms/repodata/updateinfo.xml /var/repo/rhel-7-server-rpms/repodata
chown -R apache:apache /var/repo/*
